<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accéder à mes comptes</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f2f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .login-container {
      background-color: white;
      padding: 30px 40px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 420px;
      text-align: center;
    }
    h1 {
      color: #1a8a52;
      font-size: 24px;
      margin-bottom: 25px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .input-group {
      text-align: left;
      margin-bottom: 20px;
    }
    .input-group label {
      display: block;
      color: #333;
      margin-bottom: 8px;
      font-weight: 500;
    }
    .input-wrapper {
      position: relative;
    }
    .input-wrapper input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .clear-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: #e0e0e0;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      line-height: 24px;
      text-align: center;
    }
    .keypad {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    .keypad button {
      background-color: #1a8a52;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 20px;
      font-weight: bold;
      padding: 12px 0;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .keypad button:hover {
      background-color: #0f7a45;
    }
    .submit-btn {
      width: 100%;
      padding: 15px;
      background-color: #1a8a52;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .submit-btn:hover {
      background-color: #0f7a45;
    }
    .error-message {
      color: #d23a3a;
      font-weight: bold;
      margin-bottom: 15px;
      text-align: center;
    }
    .hint {
      color: #666;
      font-size: 13px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <h1>ACCÉDER À MES COMPTES</h1>
    <form id="loginForm" autocomplete="off" novalidate>
      <div class="input-group">
        <label for="clientNumber">1. Numéro client</label>
        <div class="input-wrapper">
          <input type="text" id="clientNumber" name="clientNumber" autocomplete="off" inputmode="text">
          <button type="button" class="clear-btn" onclick="clearInput('clientNumber')" aria-label="Effacer le numéro client">✕</button>
        </div>
      </div>

      <div class="input-group">
        <label for="secretCode">2. Code secret (6 chiffres)</label>
        <div class="input-wrapper">
          <input type="password" id="secretCode" name="secretCode" readonly aria-label="Code secret">
          <button type="button" class="clear-btn" onclick="clearInput('secretCode')" aria-label="Effacer le code">✕</button>
        </div>
      </div>

      <p id="error-message" class="error-message" style="display:none;">Numéro client ou code secret incorrect.</p>

      <div class="keypad" aria-hidden="false" role="group" aria-label="Pavé numérique">
        <!-- Les touches sont injectées par le script -->
      </div>

      <div style="display:flex; gap:10px; margin-bottom:12px;">
        <button type="button" id="backspaceBtn" class="keypad-action" style="flex:1;padding:10px;border-radius:8px;border:none;cursor:pointer;">←</button>
        <button type="button" id="clearBtn" class="keypad-action" style="flex:2;padding:10px;border-radius:8px;border:none;cursor:pointer;">Effacer</button>
      </div>

      <button type="submit" class="submit-btn">Accéder à mes comptes</button>
    </form>
  </div>

  <script>
    // ------- NOTE DE SÉCURITÉ (pour l'utilisation locale) -------
    // Les valeurs ne sont **pas** stockées en clair dans le HTML.
    // Seuls des hachages SHA-256 sont conservés ici pour la comparaison côté client.
    // Pour un système réel : authentification côté serveur obligatoire.
    // ----------------------------------------------------------

    document.addEventListener('DOMContentLoaded', () => {
      const keypadContainer = document.querySelector('.keypad');
      const secretCodeInput = document.getElementById('secretCode');
      const loginForm = document.getElementById('loginForm');
      const errorMessage = document.getElementById('error-message');
      const backspaceBtn = document.getElementById('backspaceBtn');
      const clearBtn = document.getElementById('clearBtn');

      // Ordre des touches (on peut ajuster l'ordre)
      const keys = ['9','2','3','6','0','7','1','5','4','8'];

      // Crée les boutons du pavé
      keys.forEach(key => {
        const button = document.createElement('button');
        button.type = 'button';
        button.setAttribute('aria-label', 'Touche ' + key);
        button.textContent = key;
        button.addEventListener('click', () => {
          // limite à 6 chiffres
          if (secretCodeInput.value.length < 6) {
            secretCodeInput.value += key;
            errorMessage.style.display = 'none';
          }
        });
        keypadContainer.appendChild(button);
      });

      backspaceBtn.addEventListener('click', () => {
        secretCodeInput.value = secretCodeInput.value.slice(0, -1);
        errorMessage.style.display = 'none';
      });

      clearBtn.addEventListener('click', () => {
        clearInput('secretCode');
      });

      // --- HACHES SHA-256 autorisés (ne sont pas lisibles comme mots de passe en clair) ---
      // Remplacé avec le SHA-256 du numéro client fourni (1007336209)
      const allowedClientHash = "4d8724e2f30f9878119e5cb8c3f348be79b490898c19c48ed1a9b42cb45e5c69";
      // Le hash du code secret 705001 (déjà présent)
      const allowedCodeHash   = "c4cb9e685fc36bba4c568f69f33307c870d91e183dcd4ddfe524d456897df2aa";

      // fonction utilitaire -> calcule SHA-256 d'une chaîne et retourne hexa
      async function sha256Hex(message) {
        const encoder = new TextEncoder();
        const data = encoder.encode(message);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      }

      loginForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        errorMessage.style.display = 'none';

        const clientNumberRaw = document.getElementById('clientNumber').value.trim();
        const secretCodeRaw = secretCodeInput.value;

        if (!clientNumberRaw || secretCodeRaw.length !== 6) {
          // simple validation
          errorMessage.textContent = 'Veuillez saisir votre numéro client et votre code secret (6 chiffres).';
          errorMessage.style.display = 'block';
          return;
        }

        // calcule les hachages côté client et compare aux hachages autorisés
        try {
          const clientHash = await sha256Hex(clientNumberRaw);
          const codeHash = await sha256Hex(secretCodeRaw);

          if (clientHash === allowedClientHash && codeHash === allowedCodeHash) {
            // authentification "réussie" côté client (pour usage local/demo)
            sessionStorage.setItem("connected", "1");
            // redirection - adapte la page de destination si besoin
            window.location.href = 'dashboard.html';
          } else {
            errorMessage.textContent = 'Numéro client ou code secret incorrect.';
            errorMessage.style.display = 'block';
            secretCodeInput.value = '';
          }
        } catch (err) {
          console.error(err);
          errorMessage.textContent = 'Erreur lors de la vérification.';
          errorMessage.style.display = 'block';
        }
      });
    });

    function clearInput(fieldId) {
      const el = document.getElementById(fieldId);
      if (el) el.value = '';
      const em = document.getElementById('error-message');
      if (em) em.style.display = 'none';
    }
  </script>
</body>
</html>
